{% extends 'base/base.html' %}
{% block content %}
    <div class="animated fadeIn">
    <div class="card">
        <div class="card-body">

            <div class="row">
                <div class="col-6">
                    <h1>{{ station.name }}</h1>
                    <h4>Registrada por: {{ station.owner }}</h4>
                    <p><b>En la ciudad:</b> {{ station.city }} </p>
                    <p><b>En la fecha:</b> {{ station.date_registered }} </p>
                    <h4>Ubicacion</h4>
                    <ul>
                        <li>Longitud: {{ station.location_longitude }}</li>
                        <li>Latitud: {{ station.location_latitude }}</li>
                        <li>Altitud: {{ station.location_altitude }}</li>
                    </ul>
                </div>
                <div class="col-6">
                    <div id="map" style="width:100%;height:400px"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <table id="readings-table" class="table table-hover table-responsive">
                        <thead>
                        <tr>
                            <th></th>
                            <th>Sensor</th>
                            <th>Medida</th>
                            <th>Fecha</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <th scope="row">{{ station.id }}</th>
                            <td>{{ station.name }}</td>
                            <td>
                                {{ station.city|truncatechars:15 }}
                            </td>
                            <td>
                                {{ station.owner.username }}
                            </td>
                            <td>
                                <a href="{% url 'station_view' station_id=station.id %}">
                                    <btn class="btn-info btn">Ver M&aacute;s</btn>
                                </a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <!--/.card-->
    </div>

{% endblock %}

{% block extra_js %}
    <script>
        {#        function hola() {#}
        {#            var location = new google.maps.LatLng({{ station.location_latitude }}, {{ station.location_longitude }});#}
        {#            var mapOptions = {#}
        {#                center: location,#}
        {#                zoom: 15#}
        {#            };#}
        {#            var map = new google.maps.Map(document.getElementById("map"), mapOptions);#}
        {##}
        {#            var marker = new google.maps.Marker({#}
        {#                position: location,#}
        {#                map: map#}
        {#            });#}
        {#        }#}
        setInterval(function () {
            // Do something every 5 seconds
            console.log('haskldfljasd');
            $readings_table = $('#readings-table');
            $.get("http://localhost:8000/api/sensor_reading/read/?amount=5&station={{ station.id }}", function (response, status) {
                $readings_table = $('#readings-table').empty();
                console.log('hi');
                response.forEach(function (data) {

                    $readings_table.append('<tr> <td>' + data['id'] + '</td> <td>' + data['sensor_name'] + '</td><td>' + data['data'] + '</td><td>' + data['date'] + '</td></tr>')
                });
            });
        }, 2000)
    </script>

    {#    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyARzXZNW2i1qOT9dZUTfIpqh08UI1IiS8Q&callback=hola"></script>#}

    <script>
    </script>
{% endblock %}
